问题：A部门分摊给B部门的费用是多少？
1.从CostDataBase表中查询A部门在FY25的费用分摊给B部门的费用
2.根据CostDataBase、Table7表中都有的字段key做关联查询，根据语义中的筛选条件从Table7中筛选出中间表table1 
3.从table1中按照month分组，查询每个month的费用分摊给B部门的费用比例（注意每个月针对不同的cc有不同的费用分摊比例需要将不同cc的费用分摊比例累加起来才能得到每个month的费用分摊给B部门的费用比例，在得到month_rateNo后，根据month_rateNo从CostDataBase表中查询该month的费用分摊给B部门的费用，计算每个month的费用分摊给B部门的费用，公式：费用分摊给B部门的费用 = amount*mouth_rageNo）
4.将每个month的费用分摊给B部门的费用比例累加起来，得到A部门在FY25的费用分摊给B部门的费用
最终形成的# 4. 拼接完整SQL语句（嵌入动态生成的WHERE子句） 
# 由于当前环境使用 Pandas 而非 SQL 数据库，以下 SQL 仅供逻辑参考
# sql = f""" 
# SELECT 
#     cdb.`Month`, 
#     SUM(COALESCE(t7.`Value`, 0)) AS `rate`, 
#     cdb.`Amount` AS `amount` 
# FROM 
#     CostDataBase cdb   
# LEFT JOIN 
#     Table7 t7   
# ON 
#     cdb.`Month` = t7.`Month`  -- 注意: Table7 使用 North 列对应 Month
#     AND cdb.`Year` = t7.`Year` 
#     AND cdb.`Scenario` = t7.`Scenario` 
#     AND cdb.`Key` = t7.`Key` 
# {where_clause} 
# GROUP BY 
#     cdb.`Month`, 
#     cdb.`Amount` 
# ORDER BY 
#     cdb.`Month`; 
# """

# 对应的 Pandas 实现逻辑：
# 1. 准备主表 (cdb) 和费率表 (t7)
# 2. 先对费率表 (t7) 进行预聚合，确保每个 Month+Key 组合的费率唯一
# 3. 执行合并 (Merge)，关联键通常为 ['Month', 'Year', 'Scenario', 'Key']

# Step 1: 预处理和筛选
cdb = CostDataBase.query("Year == 'FY25' and Scenario == 'Actual'")
t7 = Table7.query("Year == 'FY25' and Scenario == 'Actual' and BL == 'CT'")

# Step 2: 预聚合费率表 (Pre-aggregate Rate Table)
# 关键步骤：按 Month 和 Key 汇总费率，避免多对多合并导致金额重复
t7_agg = t7.groupby(['Month', 'Key'])['RateNo'].sum().reset_index()

# Step 3: 执行合并 (Merge)
merged_df = pd.merge(
    cdb, 
    t7_agg, 
    on=['Month', 'Key'], 
    how='left'
)

# Step 4: 计算分摊金额 (Allocated_Amount)
# 处理空值: RateNo 默认为 0
merged_df['RateNo'] = merged_df['RateNo'].fillna(0)
merged_df['Allocated_Amount'] = merged_df['Amount'] * merged_df['RateNo']

# Step 5: 分组汇总结果
# 1. 计算总分摊金额
amount_result = merged_df.groupby('Month')['Allocated_Amount'].sum()

# 2. 计算分摊比例 (验证用)
# 针对同样的Key进行汇总: 先对 Month+Key 去重，再求和 RateNo
rate_result = merged_df[['Month', 'Key', 'RateNo']].drop_duplicates().groupby('Month')['RateNo'].sum()

# 3. 合并展示
result = pd.concat([amount_result, rate_result], axis=1).reset_index()
result = result.rename(columns={'RateNo': 'Total_Rate'})
result = result.sort_values('Month')
```